<div style="cursor: pointer;" ng-click="grid.appScope.toggleTooltip(row.entity)" translate-attr="{'title': 'LOTS.SHOW_WARNINGS' }" class="ui-grid-cell-contents text-center" translate>
  <span 
    uib-popover-template="'warningLotsMessage.html'" 
    popover-trigger="none" 
    popover-is-open="row.entity.tooltipIsOpen" 
    popover-append-to-body="true"
    translate>
    <i ng-if="!row.entity.has_risky_lots"  class="fa fa-check text-success"></i>
    
    <i ng-if="row.entity.has_risky_lots" class="fa fa-warning text-danger"></i>
  </span>
</div>

<script type="text/ng-template" id="warningLotsMessage.html">
  <!-- no expiration risk -->
  <div ng-if="!row.entity.lots.length">
    <i class="fa fa-check text-success"></i> <span class="text-success" translate>LOTS.NO_RISK_OF_EXPIRATION</span>
  </div>

  <!-- expiration risk -->
  <div ng-if="row.entity.lots.length">
    <div ng-repeat="lot in row.entity.lots | limitTo: 3">
      <i class="fa fa-warning text-danger"></i> 
      <span class="text-danger" 
        translate="LOTS.RISK_OF_EXPIRATION"
        translate-values="{
          quantity : row.entity.quantity,
          unit : row.entity.unit_type,
          label : row.entity.label,
          expiration : row.entity.delay_expiration
        }"></span>
    </div>
  </div>

  <div ng-if="row.entity.lots.length > 3">...</div>

  <div class="text-right">
    <a ui-sref="stockLots({ filters : [
      { key : 'inventory_uuid', value : row.entity.inventory_uuid, displayValue : row.entity.text, cacheable: false },
      { key : 'depot_uuid', value : row.entity.depot_uuid, displayValue : row.entity.depot_text, cacheable: false },
      { key : 'limit', value : 1000, cacheable: false }
    ]})" href>Voir les lots</a>
  </div>
</script>